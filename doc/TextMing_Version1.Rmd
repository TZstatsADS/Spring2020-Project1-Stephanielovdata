---
title: "Project 1 - What Lyrics Say"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Which are the words you hear the most while listening to music? In different genres, which are the most used words? Which genres is the word "love" most used? In this project, I am interested in exploring these questions. I tried to answer them by using lyrics databases and analyzing them with Rstudio. 

Step 0 - Load all the required libraries

```{r echo=FALSE,message=FALSE,warning=FALSE}
suppressMessages(library(ggplot2))
suppressMessages(library(readr))
suppressMessages(library(dplyr))
suppressMessages(library(tidyr))
suppressMessages(library(tidytext))
suppressMessages(library(RColorBrewer))
suppressMessages(library(reshape2))
suppressMessages(library(wordcloud))
suppressMessages(library(igraph))
suppressMessages(library(widyr))
suppressMessages(library(ggraph))
suppressMessages(library(ngram))
suppressMessages(library(wordcloud2))
suppressMessages(library(tm))
suppressMessages(library(data.table))
suppressMessages(library(tidyverse))
suppressMessages(library(DT))
suppressMessages(library(textdata))

```

Step 1 - Load the data to be cleaned and processed

```{r echo=FALSE,message=FALSE,warning=FALSE}
load('../output/processed_lyrics.RData') 
lyrics2 <- dt_lyrics
dt_artist <- fread('../data/artists.csv') 
```

# Who are the artists? 
```{r echo=FALSE,message=FALSE,warning=FALSE}
library(wordcloud)
n_by_artist <- lyrics2 %>%
  group_by(artist) %>%
  count(artist, sort=TRUE)
n_by_artist
```

```{r echo=FALSE,message=FALSE,warning=FALSE}
wordcloud2(n_by_artist[1:600,],  
            size = .5)
   
```


There are 10 types of genres: which are: country, eletronic, folk, hip-hop, indie, Jazz, Metal, Pop, R&B, and Rock. For the next analysis, removing the unknown genres will be helpful. 

### Lyrics Analysis

```{r echo=FALSE,message=FALSE,warning=FALSE}

original_lyrics <- lyrics2 %>% 
  group_by(artist) %>%
  mutate(linenumber = row_number()) %>%
  ungroup()

tidy_lyrics <- original_lyrics %>% 
  unnest_tokens(word, stemmedwords)

```
Count and find the most common words in all the lyrics as a whole. 

```{r echo=FALSE,message=FALSE,warning=FALSE}
n_by_genre <- tidy_lyrics %>%
  group_by(genre) %>%
  count(word, sort = TRUE)
n_by_genre
```

### WordCloud
We used the lexicon from Bing. 

```{r echo=FALSE,message=FALSE,warning=FALSE}
library(reshape2)

wordcloud_all_genre <- tidy_lyrics %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("#F8766D", "#00BFC4"),
                   max.words = 300)
wordcloud_all_genre

```
### Sentiment analysis

```{r echo=FALSE,message=FALSE,warning=FALSE}
lyric_sentiment<-tidy_lyrics %>% 
  inner_join(get_sentiments("nrc"),by="word")
sentiment_plot1 <- lyric_sentiment %>%
  filter(!sentiment %in% c("positive","negative")) %>%
  count(word,sentiment,sort=TRUE)%>%
  group_by(sentiment)%>%
  top_n(n=10)%>%
  ungroup() %>%
  ggplot(aes(x=reorder(word,n),y=n,fill=sentiment))+
  geom_col(show.legend = FALSE)+
  facet_wrap(~sentiment,scales="free")+
  coord_flip() +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5))
sentiment_plot1
ggsave("../figs/sentiment_plot1.png")

  
```

From the following graph, we are interested in exploring more on the keywords: 
which genres does have the love theme? 
what electronic music try to convey?
While most genres have its main theme about love, what is the theme for Metal music? 

# Love
Observations: 

"Love" is the most used of the words in all of the generes, especially R&B, Jazz, and Pop.

Hip-hop and Metal take the last place, which is predictable. 

```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_love_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "love") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Love", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5))
keyword_love_by_genre_plot
ggsave("../figs/keyword_love_by_genre_plot.png")

```

# Time
Observations: 
"Time" is highly used of the words in all of the generes, especially R&B, Rock, and Pop.

```{r echo=FALSE,message=FALSE,warning=FALSE}

keyword_time_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "time") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Time", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5)) 

keyword_time_by_genre_plot
ggsave("../figs/keyword_time_by_genre_plot.png")

```

# Want
Observations: 

"Want" is highly hused of the words in all of the generes, especially R&B, Electronic, and Pop.

Metal and Jazz take the last place, which is predictable.

```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_want_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "wanna") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Want", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5))

keyword_want_by_genre_plot
ggsave("../figs/keyword_want_by_genre_plot.png")
```

# Life 

Observations: 

"Life" is highly used of the words in all of the generes, especially Metal, Pop, and Electronic.
```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_life_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "life") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Life", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5)) 

keyword_life_by_genre_plot
ggsave("../figs/keyword_life_by_genre_plot.png")
```

### Further analysis on Electronic, Hip-pop, and Metal

# What electronic music try to convey? 

```{r echo=FALSE,message=FALSE,warning=FALSE}
library(wordcloud)

tidy_lyrics %>%
  filter(genre == "Electronic") %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100))
```

# Feel 
Observation: 

Interesting first place - Electronic music. Electronic is usually used for expression. This basically means that what we "feel" can be accompanied very well with electronic music (which is its essence is composed of artificially created sounds)

Hip-hop and folk is least concerned with feelings 


```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_feel_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "feel") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Feel", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5))

keyword_feel_by_genre_plot
ggsave("../figs/keyword_feel_by_genre_plot.png")
```

# Where do other words, such as death, ill, and money, come from? 

```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_ill_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "ill") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "ill", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5)) 

keyword_ill_by_genre_plot
ggsave("../figs/keyword_ill_by_genre_plot.png")
```

```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_money_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word == "money") %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Money", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5)) 

keyword_money_by_genre_plot
ggsave("../figs/keyword_money_by_genre_plot.png")
```


### What Hip_Hop say? 

```{r echo=FALSE,message=FALSE,warning=FALSE}
library(wordcloud)

tidy_lyrics %>%
  filter(genre == "Hip-Hop") %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100))
```


# Death

Observations:

Metal music is further highly related to the keyword "death" than other genres. 

```{r echo=FALSE,message=FALSE,warning=FALSE}
keyword_death_by_genre_plot <- n_by_genre %>%
  group_by(genre) %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  mutate(percentage = n/sum(n)) %>%
  filter (word %in% c("death", "dies","die")) %>%
  ggplot(aes(reorder(genre, percentage), percentage, fill = percentage)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(title = "Death", x = "", y = "percentage of word usage") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5)) 

keyword_death_by_genre_plot
ggsave("../figs/keyword_death_by_genre_plot.png")
```

### What are the most frequently used words in Metal music?

```{r echo=FALSE,message=FALSE,warning=FALSE}
library(wordcloud)

tidy_lyrics %>%
  filter(genre == "Metal") %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100))
```

# tf-idf 
```{r echo=FALSE,message=FALSE,warning=FALSE}
# still need to learn how to use td idf 
lyrics_by_genre <- tidy_lyrics %>%
  group_by(genre) %>%
  count(genre, word, sort = TRUE)

tf_idf <- lyrics_by_genre %>%
  bind_tf_idf(word, genre, n) %>%
  arrange(desc(tf_idf)) 
tf_idf
```

# Plot after tf-idf
```{r echo=FALSE,message=FALSE,warning=FALSE}

tf_idf_plot <- tf_idf %>%
  filter(genre != "Not Available" & genre != "Other") %>%
  group_by(genre) %>%
  top_n(10, tf_idf) %>% 
  ungroup() %>%  
  mutate(word = factor(word),
    word = reorder(word, tf_idf)) %>%
  ggplot(aes(word,tf_idf,fill = genre)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~genre, ncol = 3, scales = "free") +
  coord_flip() +
  labs(y = "tf-idf") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust= 0.5))
tf_idf_plot
ggsave("../figs/tf_idf_plot.png")
```


```{r echo=FALSE,message=FALSE,warning=FALSE}
save(n_by_genre, file="../output/n_by_genre.RData")
save(tf_idf, file="../output/tf_idf.RData")


```

### Summary of 10 types of lyrics
Rock, Pop and Hip-Hop are the three largest datasets. 
Feeling is for most artists, especially elecronic musicians, who want to convey from the songs. (key word: feel)
The inspiration of the lyrics may always from the lives of the artists. (key word: life)
Love is the main theme for most of the lyrics especially for Jazz (key word: Love)
Not only Hip-Hop but also other lyrics like to use rhyme words such as "Yeah."

Rock, pop, country, electronic, Jazz, Indie and Folk songs are about love and other positive feelings. Some artists talk about home, world and life (day and night) while others talk about the people they are in love with. 

Hip-Hop are also about money and include rhyme like ya, yo, em. 

Metal is the only one which has many negative words (death, blood) as top frequencies words. 

### References
https://www.tidytextmining.com/tidytext.html

https://www.thetoptens.com/false-stereotypes-about-music-genres/



